<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parreira Sistemas</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="core/styles/portal.css">
</head>

<body>
    <header class="header">
        <div class="logo">
            <div class="logo-icon">
                <span class="material-icons-round">hub</span>
            </div>
            <div class="logo-text">
                <h1>Parreira Sistemas</h1>
                <span>Enterprise Platform</span>
            </div>
        </div>
        <div class="user-info">
            <div class="user-name">
                <strong id="userName">Carregando...</strong>
                <span id="userRole">-</span>
            </div>
            <button class="btn-logout" onclick="logout()">
                <span class="material-icons-round">logout</span>
                Sair
            </button>
        </div>
    </header>

    <main class="main">
        <div class="welcome">
            <h2>Selecione um M√≥dulo</h2>
            <p>Escolha o m√≥dulo que deseja acessar</p>
        </div>

        <div class="modules-grid">
            <!-- Master -->
            <div class="module-card module-master disabled" onclick="openModule('master')">
                <div class="module-icon">
                    <span class="material-icons-round">admin_panel_settings</span>
                </div>
                <h3>Master Panel</h3>
                <p>Gest√£o de clientes, m√≥dulos e configura√ß√µes da plataforma.</p>
                <span class="module-status master">üëë Administrador</span>
            </div>

            <!-- ERP -->
            <div class="module-card module-erp disabled" onclick="openModule('erp')">
                <div class="module-icon">
                    <span class="material-icons-round">account_balance</span>
                </div>
                <h3>ERP</h3>
                <p>Gest√£o completa: Financeiro, Fiscal, CRM, Vendas, Cadastros.</p>
                <span class="module-status coming">üöß Em desenvolvimento</span>
            </div>

            <!-- Sales Force -->
            <div class="module-card module-sales disabled" onclick="openModule('sales-force')">
                <div class="module-icon">
                    <span class="material-icons-round">phone_android</span>
                </div>
                <h3>For√ßa de Vendas</h3>
                <p>App para vendedores externos com funcionamento offline.</p>
                <span class="module-status coming">üöß Em desenvolvimento</span>
            </div>

            <!-- WMS -->
            <div class="module-card module-wms disabled" onclick="openModule('wms')">
                <div class="module-icon">
                    <span class="material-icons-round">warehouse</span>
                </div>
                <h3>WMS</h3>
                <p>Gest√£o de armaz√©m para +10.000 SKUs com rastreabilidade.</p>
                <span class="module-status coming">üöß Em desenvolvimento</span>
            </div>

            <!-- Dispatch -->
            <div class="module-card module-dispatch" onclick="openModule('dispatch')">
                <div class="module-icon">
                    <span class="material-icons-round">local_shipping</span>
                </div>
                <h3>Despacho Log√≠stico</h3>
                <p>Cota√ß√£o de frete, montagem de carga e romaneio.</p>
                <span class="module-status active">‚úÖ Dispon√≠vel</span>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2026 Parreira Sistemas. Desenvolvido com ‚ù§Ô∏è</p>
    </footer>

    <div class="version-badge" id="versionBadge">v1.0.0</div>

    <script>
        // Check login
        document.addEventListener('DOMContentLoaded', function () {
            const user = JSON.parse(localStorage.getItem('logged_user') || 'null');

            if (!user) {
                // Redirect to dispatch login for now
                window.location.href = 'modules/dispatch/index.html';
                return;
            }

            document.getElementById('userName').textContent = user.name || user.login;
            document.getElementById('userRole').textContent = user.role === 'supervisor' ? 'Supervisor' : 'Operacional';

            // Enable master panel for supervisors
            if (user.role === 'supervisor') {
                const masterCard = document.querySelector('.module-master');
                masterCard.classList.remove('disabled');
            }

            // Load version
            fetch('modules/dispatch/version.json')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('versionBadge').textContent = 'v' + data.version;
                })
                .catch(() => { });
        });

        function openModule(module) {
            const card = document.querySelector(`.module-${module === 'sales-force' ? 'sales' : module}`);
            if (card && card.classList.contains('disabled')) {
                return;
            }

            switch (module) {
                case 'dispatch':
                    window.location.href = 'modules/dispatch/index.html';
                    break;
                case 'master':
                    window.location.href = 'modules/master/index.html';
                    break;
                case 'erp':
                    window.location.href = 'modules/erp/index.html';
                    break;
                case 'wms':
                    window.location.href = 'modules/wms/index.html';
                    break;
                case 'sales-force':
                    window.location.href = 'modules/sales-force/index.html';
                    break;
            }
        }

        function logout() {
            localStorage.removeItem('logged_user');
            window.location.href = 'modules/dispatch/index.html';
        }
    </script>
</body>

</html>