<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ParreiraLog | Cota√ß√£o de Fretes</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ParreiraLog">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="ParreiraLog">
    <meta name="msapplication-TileColor" content="#3b82f6">
    <meta name="msapplication-tap-highlight" content="no">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=dataset:300,400,500,600,700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <style>
        /* Specific Styles for Quoting - Compact Version */
        .quote-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .form-section {
            background: var(--bg-card);
            padding: 1.25rem;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
        }

        .form-group {
            margin-bottom: 0.9rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.35rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .form-input {
            width: 100%;
            background: var(--bg-body);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-md);
            outline: none;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .results-section {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        /* Fix Table Alignment */
        .dispatch-table th,
        .dispatch-table td {
            vertical-align: middle !important;
        }

        .result-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: var(--radius-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .result-card.best-option {
            border-color: var(--accent-success);
            background: rgba(16, 185, 129, 0.05);
        }

        .result-card.best-option::before {
            content: 'MELHOR OP√á√ÉO';
            position: absolute;
            top: 0;
            right: 0;
            background: var(--accent-success);
            color: white;
            font-size: 0.6rem;
            padding: 3px 6px;
            border-bottom-left-radius: 6px;
            font-weight: 700;
        }

        .carrier-name {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 0.15rem;
        }

        .carrier-details {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .price-tag {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .file-upload-mini {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 0.35rem;
            cursor: pointer;
            text-decoration: underline;
        }

        /* Compact welcome banner for quote page */
        #view-quote .welcome-banner {
            margin-bottom: 1rem;
        }

        #view-quote .welcome-banner h2 {
            font-size: 1.25rem;
            margin-bottom: 0.15rem;
        }

        #view-quote .welcome-banner p {
            font-size: 0.85rem;
        }
    </style>

</head>

<body>
    <div id="loginOverlay" class="login-overlay">
        <div class="login-card">
            <div style="text-align: center; margin-bottom: 2rem;">
                <div
                    style="width: 60px; height: 60px; background: var(--primary-color); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                    <span class="material-icons-round" style="font-size: 2rem; color: white;">local_shipping</span>
                </div>
                <h1 style="font-size: 1.5rem; color: var(--text-primary); margin-bottom: 0.5rem;">ParreiraLog</h1>
                <p style="color: var(--text-secondary);">Fa√ßa login para continuar</p>
            </div>

            <div class="form-group">
                <label class="form-label">ID da Empresa</label>
                <input type="text" id="loginTenantInput" class="form-input"
                    style="height: 48px; text-transform: lowercase;" placeholder="ex: parreiralog" value="parreiralog">
            </div>

            <div class="form-group">
                <label class="form-label">Usu√°rio</label>
                <select id="loginUserSelect" class="form-input" style="height: 48px;">
                    <option value="admin">Administrador (admin)</option>
                    <!-- Populated by JS -->
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Senha</label>
                <input type="password" id="loginPassInput" class="form-input" style="height: 48px;"
                    placeholder="Digite sua senha">
            </div>
            <button id="btnLogin" class="btn btn-primary"
                style="width: 100%; justify-content: center; height: 48px; font-size: 1rem;">ACESSAR SISTEMA</button>
        </div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo-area">
                <h1>ParreiraLog</h1>
            </div>


            <nav class="nav-menu">
                <a href="#dashboard" onclick="window.showSection('dashboard')" class="nav-item active">
                    <span class="material-icons-round">dashboard</span>
                    Painel
                </a>
                <a href="#quote" onclick="window.showSection('quote')" class="nav-item">
                    <span class="material-icons-round">request_quote</span>
                    Cota√ß√£o R√°pida
                </a>
                <a href="#dispatch" onclick="window.showSection('dispatch')" class="nav-item">
                    <span class="material-icons-round">local_shipping</span>
                    Montagem de Carga
                </a>
                <a href="#invoice" onclick="window.showSection('invoice')" class="nav-item">
                    <span class="material-icons-round">receipt_long</span>
                    Confer√™ncia Fatura
                </a>
                <a href="#moto" onclick="window.showSection('moto')" class="nav-item">
                    <span class="material-icons-round">two_wheeler</span>
                    Moto Entrega
                </a>
                <a href="#carro" onclick="window.showSection('carro')" class="nav-item">
                    <span class="material-icons-round">directions_car</span>
                    Carro Entrega
                </a>
                <a href="#rules" onclick="window.showSection('rules')" class="nav-item">
                    <span class="material-icons-round">table_chart</span>
                    Tabelas de Frete
                </a>
                <a href="#reports" onclick="window.showSection('reports')" class="nav-item">
                    <span class="material-icons-round">analytics</span>
                    Relat√≥rios & KPIs
                </a>
                <a href="#configs" onclick="window.showSection('configs')" class="nav-item">
                    <span class="material-icons-round">settings</span>
                    Config. Transportadoras
                </a>
                <a href="#acontec" onclick="window.showSection('acontec')" class="nav-item">
                    <span class="material-icons-round">sync</span>
                    Integra√ß√£o Acontec
                </a>
                <a href="#system" onclick="window.showSection('system')" class="nav-item">
                    <span class="material-icons-round">business</span>
                    Configura√ß√µes
                </a>

                <a href="#" onclick="window.logoutUser()" class="nav-item"
                    style="margin-top: auto; color: var(--accent-danger);">
                    <span class="material-icons-round">logout</span>
                    Sair
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <div class="breadcrumb">
                    <span class="text-muted">Transportadora</span> / <span class="current">Cota√ß√£o</span>
                </div>
            </header>

            <div class="content-wrapper">
                <div id="view-dashboard" class="view-section" style="display: block;">
                    <div class="welcome-banner" style="margin-bottom: 2rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                            <div>
                                <h2>Painel de Despacho</h2>
                                <p>Gerencie as cargas pendentes e gere romaneios por transportadora.</p>
                            </div>
                            <div id="dashboardSummary"
                                style="display: flex; gap: 2rem; background: rgba(59, 130, 246, 0.1); padding: 1rem 2rem; border-radius: var(--radius-lg); border: 1px solid var(--border-color);">
                                <div style="text-align: center;">
                                    <div
                                        style="font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase;">
                                        Total Notas</div>
                                    <div id="dashTotalInvoices" style="font-size: 1.2rem; font-weight: 700;">0
                                    </div>
                                </div>
                                <div style="text-align: center;">
                                    <div
                                        style="font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase;">
                                        Peso Total</div>
                                    <div id="dashTotalWeight" style="font-size: 1.2rem; font-weight: 700;">0 kg
                                    </div>
                                </div>
                                <div style="text-align: center;">
                                    <div
                                        style="font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase;">
                                        Frete Acumulado</div>
                                    <div id="dashTotalFreight"
                                        style="font-size: 1.2rem; font-weight: 700; color: var(--accent-success);">
                                        R$
                                        0,00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="carrierDashboardGrid" class="grid-2-col">
                        <!-- Carrier Cards will be injected here -->
                    </div>
                </div>

                <!-- Detail Modal for Carrier Shipment -->
                <div id="shipmentModal" class="login-overlay" style="display: none;">
                    <div class="login-card" style="max-width: 900px; width: 95%;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 id="modalCarrierTitle" style="margin: 0;">Itens Pendentes: Transportadora
                            </h3>
                            <button onclick="document.getElementById('shipmentModal').style.display='none'"
                                class="btn btn-secondary" style="padding: 0.4rem; min-width: auto; border: none;">
                                <span class="material-icons-round">close</span>
                            </button>
                        </div>
                        <div style="max-height: 400px; overflow-y: auto; margin-bottom: 1.5rem;">
                            <table class="dispatch-table">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;"><input type="checkbox" id="selectAllNFs" checked>
                                        </th>
                                        <th>NF</th>
                                        <th>Cliente</th>
                                        <th>Cidade</th>
                                        <th>Peso (kg)</th>
                                        <th>Frete</th>
                                        <th style="text-align: right;">A√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody id="shipmentModalBody">
                                    <!-- Items loaded by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">
                                Selecionados: <strong id="modalSelectedCount">0</strong> |
                                Subtotal: <strong id="modalSelectedTotal" style="color: var(--accent-success);">R$
                                    0,00</strong>
                            </div>

                            <!-- NOVO: Seletor de tipo de despacho -->
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <label style="font-size: 0.85rem; color: var(--text-secondary);">Levar at√©
                                    transp.:</label>
                                <select id="deliveryTypeSelector" class="form-input"
                                    style="padding: 0.4rem 0.75rem; font-size: 0.85rem; min-width: 150px;">
                                    <option value="direto">üì¶ Direto (Pr√≥prio)</option>
                                    <option value="moto">üèçÔ∏è Moto Entrega</option>
                                    <option value="carro">üöó Carro Entrega</option>
                                </select>
                            </div>

                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-secondary"
                                    onclick="document.getElementById('shipmentModal').style.display='none'">VOLTAR</button>
                                <button class="btn btn-primary" id="btnGenerateRomaneio" style="gap: 0.5rem;"
                                    onclick="window.generateRomaneioAction()">
                                    <span class="material-icons-round">print</span> GERAR ROMANEIO
                                </button>
                            </div>
                        </div>
                    </div>
                </div>



                <div id="view-quote" class="view-section" style="display: none;">
                    <div class="welcome-banner">

                        <h2>Nova Cota√ß√£o</h2>
                        <p>Preencha os dados da Nota Fiscal para encontrar a melhor transportadora.</p>
                    </div>

                    <div class="quote-container">
                        <!-- Input Form -->
                        <div class="form-section">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                                <h3 style="font-size: 1rem; margin: 0;">Dados da Nota Fiscal</h3>

                                <button type="button" onclick="window.resetQuote()" class="btn btn-secondary"
                                    style="font-size: 0.75rem; padding: 0.4rem 0.8rem; gap: 0.4rem; border-color: rgba(255,0,0,0.1); color: var(--accent-danger);">
                                    <span class="material-icons-round" style="font-size: 1rem;">restart_alt</span>
                                    NOVO C√ÅLCULO
                                </button>
                            </div>

                            <div class="form-group"
                                style="display: grid; grid-template-columns: 1fr 0.8fr 1fr; gap: 0.8rem; align-items: start;">
                                <div>
                                    <label class="form-label">N√∫mero da NF</label>
                                    <input type="text" id="inputInvoiceNumber" class="form-input"
                                        placeholder="Ex: 10520"
                                        oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                </div>
                                <div>
                                    <label class="form-label">Complemento?</label>
                                    <select id="inputIsComplement" class="form-input" style="height: 43px;">
                                        <option value="nao">N√£o</option>
                                        <option value="sim">Sim</option>
                                    </select>
                                </div>
                                <div id="divMainNF" style="display: none;">
                                    <label class="form-label">NF Principal</label>
                                    <input type="text" id="inputMainNF" class="form-input" placeholder="Ref. original"
                                        oninput="this.value = this.value.replace(/[^0-9]/g, '');">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Cliente (C√≥digo ou Nome)</label>
                                <div style="display: flex; gap: 0.5rem;">
                                    <input type="text" id="inputClient" class="form-input"
                                        placeholder="Ex: 1721 ou JOSIEL...">
                                    <button class="btn btn-primary" id="btnSearchClient">
                                        <span class="material-icons-round">search</span>
                                    </button>
                                </div>
                                <label for="fileClient" class="file-upload-mini">Carregar clientes.csv</label>
                                <input type="file" id="fileClient" hidden accept=".csv">
                            </div>

                            <div class="form-group" id="clientResult"
                                style="display:none; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: var(--radius-md);">
                                <div style="font-weight: 600;" id="resClientName">Name</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                    <span id="resCity">Cidade</span> - <span id="resNeighborhood">Bairro</span>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Valor da Nota Fiscal (R$)</label>
                                <input type="number" id="inputValue" class="form-input" placeholder="0,00">
                            </div>

                            <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem;">
                                <div>
                                    <label class="form-label">Peso Bruto (Kg)</label>
                                    <input type="number" id="inputWeight" class="form-input" placeholder="0.000">
                                </div>
                                <div>
                                    <label class="form-label">Qtde Volume</label>
                                    <input type="number" id="inputVolume" class="form-input" placeholder="1" min="1">
                                </div>

                            </div>


                        </div>

                        <!-- Results -->
                        <div class="results-section" id="resultsArea">
                            <!-- Empty State -->
                            <div style="text-align: center; color: var(--text-secondary); margin-top: 4rem;">
                                <span class="material-icons-round"
                                    style="font-size: 3rem; opacity: 0.3;">calculate</span>
                                <p>Aguardando c√°lculo...</p>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- VIEW: MOTO ENTREGA -->
                <div id="view-moto" class="view-section" style="display: none;">
                    <div class="welcome-banner" style="margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                            <div>
                                <h2 style="color: #f59e0b;">üèçÔ∏è Moto Entrega</h2>
                                <p>Gerencie suas entregas por moto.</p>
                            </div>
                            <div id="motoStats"
                                style="display: flex; gap: 1rem; background: rgba(245, 158, 11, 0.1); padding: 0.75rem 1.5rem; border-radius: var(--radius-lg); border: 1px solid rgba(245, 158, 11, 0.2);">
                                <div style="text-align: center;">
                                    <div
                                        style="font-size: 0.65rem; color: var(--text-secondary); text-transform: uppercase;">
                                        Pendentes</div>
                                    <div id="motoPendentes"
                                        style="font-size: 1.25rem; font-weight: 700; color: #f59e0b;">0</div>
                                </div>
                                <div style="text-align: center;">
                                    <div
                                        style="font-size: 0.65rem; color: var(--text-secondary); text-transform: uppercase;">
                                        Entregues Hoje</div>
                                    <div id="motoEntregues"
                                        style="font-size: 1.25rem; font-weight: 700; color: var(--accent-success);">0
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round" style="color: #f59e0b;">pending_actions</span>
                                Entregas Pendentes
                            </h3>
                            <button onclick="DeliveryModule.renderMotoEntregas()" class="btn btn-secondary"
                                style="padding: 0.5rem 1rem;">
                                <span class="material-icons-round" style="font-size: 1rem;">refresh</span>
                                Atualizar
                            </button>
                        </div>
                        <div class="card-body" style="padding: 1rem;">
                            <div id="motoEntregasContainer">
                                <!-- Cards de entregas ser√£o renderizados aqui -->
                                <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                                    <span class="material-icons-round"
                                        style="font-size: 4rem; opacity: 0.3;">two_wheeler</span>
                                    <h3 style="margin: 1rem 0 0.5rem;">Nenhuma entrega pendente</h3>
                                    <p style="margin: 0;">As NFs despachadas para Moto Entrega aparecer√£o aqui.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: CARRO ENTREGA -->
                <div id="view-carro" class="view-section" style="display: none;">
                    <div class="welcome-banner" style="margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
                            <div>
                                <h2 style="color: #10b981;">üöó Carro Entrega</h2>
                                <p>Gerencie suas entregas por carro.</p>
                            </div>
                            <div id="carroStats"
                                style="display: flex; gap: 1rem; background: rgba(16, 185, 129, 0.1); padding: 0.75rem 1.5rem; border-radius: var(--radius-lg); border: 1px solid rgba(16, 185, 129, 0.2);">
                                <div style="text-align: center;">
                                    <div
                                        style="font-size: 0.65rem; color: var(--text-secondary); text-transform: uppercase;">
                                        Pendentes</div>
                                    <div id="carroPendentes"
                                        style="font-size: 1.25rem; font-weight: 700; color: #10b981;">0</div>
                                </div>
                                <div style="text-align: center;">
                                    <div
                                        style="font-size: 0.65rem; color: var(--text-secondary); text-transform: uppercase;">
                                        Entregues Hoje</div>
                                    <div id="carroEntregues"
                                        style="font-size: 1.25rem; font-weight: 700; color: var(--accent-success);">0
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round" style="color: #10b981;">pending_actions</span>
                                Entregas Pendentes
                            </h3>
                            <button onclick="DeliveryModule.renderCarroEntregas()" class="btn btn-secondary"
                                style="padding: 0.5rem 1rem;">
                                <span class="material-icons-round" style="font-size: 1rem;">refresh</span>
                                Atualizar
                            </button>
                        </div>
                        <div class="card-body" style="padding: 1rem;">
                            <div id="carroEntregasContainer">
                                <!-- Cards de entregas ser√£o renderizados aqui -->
                                <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                                    <span class="material-icons-round"
                                        style="font-size: 4rem; opacity: 0.3;">directions_car</span>
                                    <h3 style="margin: 1rem 0 0.5rem;">Nenhuma entrega pendente</h3>
                                    <p style="margin: 0;">As NFs despachadas para Carro Entrega aparecer√£o aqui.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: TABELAS DE FRETE (NOVO) -->
                <div id="view-rules" class="view-section" style="display: none;">
                    <div class="welcome-banner">
                        <h2>Tabelas de Frete</h2>
                        <p>Cadastre e gerencie as condi√ß√µes de frete por transportadora e cidade.</p>
                    </div>

                    <div class="card" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">add_circle</span>
                                Cadastrar Nova Tabela
                            </h3>
                        </div>
                        <div class="card-body" style="padding: 1.5rem;">
                            <form id="formNewRule"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="form-group">
                                    <label class="form-label">Transportadora</label>
                                    <input type="text" id="ruleCarrier" class="form-input"
                                        placeholder="Digite ou selecione..." list="carrierList" required
                                        autocomplete="off">
                                    <datalist id="carrierList"></datalist>
                                    <div id="carrierErrorAlert"
                                        style="font-size: 0.75rem; color: var(--accent-danger); margin-top: 4px; display: none; font-weight: 500;">
                                        <span class="material-icons-round"
                                            style="font-size: 0.8rem; vertical-align: middle;">error_outline</span>
                                        Transportadora n√£o cadastrada. <br>Cadastre-a na aba 'Tabelas e Taxas'
                                        antes.
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Cidade</label>
                                    <input type="text" id="ruleCity" class="form-input"
                                        placeholder="Digite ou selecione da lista..." list="cityList" required
                                        autocomplete="off">
                                    <datalist id="cityList"></datalist>
                                    <div id="cityNewAlert"
                                        style="font-size: 0.75rem; color: var(--accent-success); margin-top: 4px; display: none; font-weight: 500;">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">% Frete</label>
                                    <input type="number" step="0.01" id="rulePercent" class="form-input"
                                        placeholder="0.00" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Frete M√≠nimo (R$)</label>
                                    <input type="number" step="0.01" id="ruleMin" class="form-input" placeholder="0.00"
                                        required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Limite Peso (Kg)</label>
                                    <input type="number" step="0.1" id="ruleWeightLimit" class="form-input"
                                        placeholder="0.0" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Valor Kg Excedente (R$)</label>
                                    <input type="number" step="0.01" id="ruleExcess" class="form-input"
                                        placeholder="0.00" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Taxa Fixa (R$)</label>
                                    <input type="number" step="0.01" id="ruleToll" class="form-input"
                                        placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Cidade/Bairro para Redespacho</label>
                                    <input type="text" id="ruleRedispatchCity" class="form-input"
                                        placeholder="Ex: Ananindeua">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Redespacho (Opcional)</label>
                                    <select id="ruleRedispatch" class="form-input">
                                        <option value="">Sem Redespacho</option>
                                        <!-- Populated by JS -->
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">% Redespacho</label>
                                    <input type="number" step="0.01" id="ruleRedispatchPercent" class="form-input"
                                        placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Min. Redespacho (R$)</label>
                                    <input type="number" step="0.01" id="ruleRedispatchMin" class="form-input"
                                        placeholder="0.00">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Prazo de Entrega</label>
                                    <input type="number" id="ruleLeadTime" class="form-input" placeholder="Ex: 1">
                                </div>
                                <div class="form-group" style="grid-column: span 2;">
                                    <label class="form-label">Hor√°rios de Despacho</label>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <input type="text" id="ruleHour1" class="form-input" placeholder="10:00"
                                            style="flex: 1;">
                                        <input type="text" id="ruleHour2" class="form-input" placeholder="hora/hora"
                                            style="flex: 1;">
                                        <input type="text" id="ruleHour3" class="form-input" placeholder="19:00"
                                            style="flex: 1;">
                                    </div>
                                </div>
                                <input type="hidden" id="editingRuleIndex" value="-1">
                                <div style="grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 1rem;">
                                    <button type="button" id="btnCancelEdit" class="btn btn-secondary"
                                        style="display: none; padding: 0.75rem 2rem;">
                                        CANCELAR
                                    </button>
                                    <button type="submit" id="btnSubmitRule" class="btn btn-primary"
                                        style="padding: 0.75rem 2rem;">
                                        SALVAR TABELA
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="font-size: 1rem;">Tabelas Cadastradas</h3>
                            <div style="display: flex; gap: 0.5rem;">
                                <div style="position: relative; display: inline-block;">
                                    <button onclick="document.getElementById('colMenu').classList.toggle('show')"
                                        class="btn btn-secondary"
                                        style="font-size: 0.75rem; padding: 0.4rem 0.8rem; display: flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color);">
                                        <span class="material-icons-round" style="font-size: 1rem;">view_column</span>
                                        Colunas
                                    </button>
                                    <div id="colMenu" class="dropdown-content"
                                        style="display: none; position: absolute; right: 0; background-color: var(--card-bg); min-width: 140px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; border: 1px solid var(--border-color); border-radius: 4px; padding: 0.5rem;">
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(3, this.checked)"> %</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(4, this.checked)"> M√≠nimo</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(5, this.checked)"> Lim. Peso</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(6, this.checked)"> Vlr Exc.</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(7, this.checked)"> Cidade Red.</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(8, this.checked)"> Transp. Red.</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(9, this.checked)"> % Red.</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(10, this.checked)"> Min. Red.</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(11, this.checked)"> Taxa</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(12, this.checked)"> Prazo</label>
                                        <label style="display: block; padding: 4px;"><input type="checkbox" checked
                                                onchange="window.toggleCol(13, this.checked)"> Hor√°rios</label>
                                    </div>
                                </div>
                                <button id="btnExportTables" class="btn btn-secondary"
                                    style="font-size: 0.75rem; padding: 0.4rem 0.8rem; display: flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border-color);">
                                    <span class="material-icons-round" style="font-size: 1rem;">download</span>
                                    CSV
                                </button>
                                <button id="btnSyncData" class="btn btn-secondary"
                                    title="Importar tabelas de um arquivo CSV"
                                    style="font-size: 0.75rem; padding: 0.4rem 0.8rem; display: flex; align-items: center; gap: 0.5rem; background: rgba(16,185,129,0.1); border: 1px solid rgba(16,185,129,0.3); color: #10b981;">
                                    <span class="material-icons-round" style="font-size: 1rem;">upload_file</span>
                                    Importar
                                </button>
                                <input type="file" id="fileRules" accept=".csv" style="display: none;">
                            </div>
                        </div>
                        <div class="card-body" style="padding: 0; overflow-x: auto;">
                            <!-- Tabs de Transportadoras -->
                            <div id="carrierTabs" class="tabs-container"></div>

                            <table class="dispatch-table" id="tableRules">
                                <thead>
                                    <tr>
                                        <th style="width: 140px; min-width: 100px;">
                                            <div style="margin-bottom: 4px;">Cidade</div>
                                            <input type="text" class="filter-input" placeholder="üîé"
                                                onkeyup="window.updateRuleFilter('cidade', this.value)">
                                        </th>
                                        <th style="width: 45px;">%</th>
                                        <th style="width: 70px;">M√≠nimo</th>
                                        <th style="width: 65px;">Lim. Peso</th>
                                        <th style="width: 65px;">Vlr Exc.</th>
                                        <th style="width: 130px; min-width: 100px;">
                                            <div style="margin-bottom: 4px;">Cidade Redesp.</div>
                                            <input type="text" class="filter-input" placeholder="üîé"
                                                onkeyup="window.updateRuleFilter('cidadeRedespacho', this.value)">
                                        </th>
                                        <th style="width: 110px; min-width: 90px;">Transp. Red.</th>
                                        <th style="width: 45px;">% Red.</th>
                                        <th style="width: 65px;">Min. Red.</th>
                                        <th style="width: 60px;">Taxa</th>
                                        <th style="width: 50px;">Prazo</th>
                                        <th style="width: 75px;">Hor√°rios</th>
                                        <th style="text-align: right; width: 60px;">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="rulesListBody">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- VIEW: RELAT√ìRIOS -->
                <div id="view-reports" class="view-section" style="display: none;">
                    <div class="welcome-banner">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div>
                                <h2>Relat√≥rios Gerenciais</h2>
                                <p>Visualize indicadores de desempenho e economia do setor log√≠stico.</p>
                            </div>
                        </div>
                    </div>

                    <div id="reports-menu" class="grid-2-col" style="margin-top: 1.5rem;">
                        <!-- Report Card: Performance VAN -->
                        <div class="result-card standard-option" onclick="window.showReportDetail('van-performance')"
                            style="cursor: pointer; transition: transform 0.2s;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <span class="material-icons-round"
                                        style="color: var(--primary-color); font-size: 2rem;">local_shipping</span>
                                    <h3 style="margin: 0; font-size: 1.1rem; color: var(--text-primary);">
                                        Performance
                                        VAN</h3>
                                </div>
                                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0;">
                                    Acompanhe a economia gerada pelas negocia√ß√µes diretas com VANs em compara√ß√£o ao
                                    frete tabela.
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <span class="material-icons-round"
                                    style="color: var(--text-secondary);">chevron_right</span>
                            </div>
                        </div>

                        <!-- Report Card: Late Dispatches -->
                        <div class="result-card standard-option" onclick="window.showReportDetail('late-dispatches')"
                            style="cursor: pointer; transition: transform 0.2s;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <span class="material-icons-round"
                                        style="color: var(--accent-danger); font-size: 2rem;">alarm_off</span>
                                    <h3 style="margin: 0; font-size: 1.1rem; color: var(--text-primary);">Atrasos de
                                        Hor√°rio</h3>
                                </div>
                                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0;">
                                    Monitore notas fiscais pendentes que excederam o hor√°rio limite de sa√≠da da
                                    transportadora.
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <span class="material-icons-round"
                                    style="color: var(--text-secondary);">chevron_right</span>
                            </div>
                        </div>

                        <!-- Report Card: Delivery Report (NEW) -->
                        <div class="result-card standard-option" onclick="window.showReportDetail('delivery-report')"
                            style="cursor: pointer; transition: transform 0.2s;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <span class="material-icons-round"
                                        style="color: #f59e0b; font-size: 2rem;">two_wheeler</span>
                                    <h3 style="margin: 0; font-size: 1.1rem; color: var(--text-primary);">Relat√≥rio de
                                        Entregas</h3>
                                </div>
                                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0;">
                                    Acompanhe entregas realizadas por Motoboy e Motorista com filtros por per√≠odo e
                                    entregador.
                                </p>
                            </div>
                            <div style="text-align: right;">
                                <span class="material-icons-round"
                                    style="color: var(--text-secondary);">chevron_right</span>
                            </div>
                        </div>
                    </div>

                    <!-- Report Detail Container -->
                    <div id="report-detail-container" style="display: none; width: 100%; margin-top: 1rem;">
                        <button class="btn btn-secondary" onclick="window.closeReportDetail()"
                            style="margin-bottom: 1rem;">
                            <span class="material-icons-round">arrow_back</span> Voltar aos Relat√≥rios
                        </button>

                        <div id="report-content-area">
                            <!-- Report content injected by JS -->
                        </div>
                    </div>
                </div>

                <!-- VIEW: CONFIGURA√á√ïES DE C√ÅLCULO -->
                <div id="view-configs" class="view-section" style="display: none;">
                    <div class="welcome-banner">
                        <h2>Configura√ß√µes do Sistema</h2>
                        <p>Gerencie as transportadoras cadastradas e seus par√¢metros globais de c√°lculo.</p>
                    </div>

                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">add_business</span>
                                Cadastrar Nova Transportadora
                            </h3>
                        </div>
                        <div class="card-body" style="padding: 1.5rem;">
                            <form id="formNewCarrier"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <input type="hidden" id="editingCarrierMode" value="false">

                                <div class="form-group" style="grid-column: span 2;">
                                    <label class="form-label">Nome da Transportadora</label>
                                    <input type="text" id="newCarrierName" class="form-input"
                                        placeholder="Ex: LATAM CARGO" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">CNPJ</label>
                                    <div style="display: flex; gap: 0.5rem;">
                                        <input type="text" id="newCarrierCNPJ" class="form-input"
                                            placeholder="00.000.000/0000-00" style="flex: 1;">
                                        <button type="button" id="btnSearchCarrierCNPJ" class="btn btn-secondary"
                                            style="padding: 0.5rem 1rem; white-space: nowrap;"
                                            title="Buscar dados pelo CNPJ">
                                            üîç Buscar
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Inscri√ß√£o Estadual</label>
                                    <input type="text" id="newCarrierIE" class="form-input"
                                        placeholder="000.000.000.000">
                                </div>
                                <div class="form-group" style="grid-column: span 2;">
                                    <label class="form-label">Endere√ßo Completo</label>
                                    <input type="text" id="newCarrierAddress" class="form-input"
                                        placeholder="Rua, N√∫mero, Bairro">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Cidade/UF</label>
                                    <input type="text" id="newCarrierCity" class="form-input"
                                        placeholder="Ex: Marab√° - PA">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Confiabilidade</label>
                                    <select id="newCarrierReliability" class="form-input">
                                        <option value="4">4 - Excelente</option>
                                        <option value="3" selected>3 - Boa</option>
                                        <option value="2">2 - Ruim</option>
                                        <option value="1">1 - P√©ssima</option>
                                    </select>
                                </div>

                                <div class="form-group" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" id="newCarrierIsRedespacho"
                                        style="width: 18px; height: 18px;">
                                    <label for="newCarrierIsRedespacho" class="form-label"
                                        style="margin: 0; cursor: pointer;">
                                        √â Transportadora de Redespacho?
                                    </label>
                                </div>
                                <div style="display: flex; align-items: flex-end; gap: 0.5rem;">
                                    <button type="button" id="btnCancelEditCarrier" class="btn btn-secondary"
                                        style="padding: 0.75rem 1rem; display: none; border: 1px solid var(--border-color);">CANCELAR</button>
                                    <button type="submit" id="btnSubmitCarrier" class="btn btn-primary"
                                        style="padding: 0.75rem 2rem; width: 100%; justify-content: center;">CADASTRAR
                                        TRANSPORTADORA</button>
                                </div>


                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">settings_suggest</span>
                                Par√¢metros de C√°lculo por Transportadora
                            </h3>
                        </div>
                        <div class="card-body" style="padding: 0; overflow-x: auto;">
                            <table class="dispatch-table">
                                <thead>
                                    <tr>
                                        <th>Transportadora / CNPJ</th>
                                        <th>Taxa Fixa (R$)</th>
                                        <th>GRIS (%)</th>
                                        <th>ICMS (%)</th>
                                        <th>Vlr/Volume (R$)</th>
                                        <th style="text-align: right;">A√ß√µes</th>
                                    </tr>

                                </thead>
                                <tbody id="carrierConfigsBody">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="grid-2-col" style="margin-top: 1.5rem; gap: 1.5rem;">
                        <div class="card"
                            style="background: rgba(59, 130, 246, 0.05); border-color: rgba(59, 130, 246, 0.2);">
                            <div class="card-body"
                                style="padding: 1rem; font-size: 0.85rem; color: var(--text-secondary);">
                                <div
                                    style="font-weight: 600; color: var(--primary-color); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <span class="material-icons-round" style="font-size: 1.2rem;">info</span>
                                    Como funciona o c√°lculo:
                                </div>
                                Para cada op√ß√£o, o sistema faz: <br>
                                <strong>1. Base:</strong> Maior valor entre (Valor NF √ó % Frete da Cidade) e Valor
                                M√≠nimo da
                                Cidade. <br>
                                <strong>2. Adicionais:</strong> Soma a Taxa Fixa + Ped√°gio + (Valor NF √ó % GRIS).
                                <br>
                                <strong>3. Excedente:</strong> Soma o (Peso Excedente √ó Valor Kg Excedente) se
                                houver.
                                <br>
                                <strong>4. Imposto:</strong> O total acumulativo √© dividido por (1 - % ICMS/100)
                                para
                                aplicar o c√°lculo "por dentro".
                            </div>
                        </div>

                    </div>

                    <!-- SE√á√ÉO 2: GEST√ÉO DE USU√ÅRIOS (Lado a Lado) -->
                    <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                        <h3 class="section-title" style="margin-bottom: 1.5rem;">Gest√£o de Usu√°rios</h3>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">

                            <!-- COLUNA ESQUERDA: FORMUL√ÅRIO -->
                            <div>
                                <div class="card">
                                    <div class="card-header">
                                        <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                            <span class="material-icons-round">person_add</span>
                                            Dados do Usu√°rio
                                        </h3>
                                    </div>
                                    <div class="card-body" style="padding: 1.5rem;">
                                        <form id="formNewUser"
                                            onsubmit="event.preventDefault(); window.saveUserAction();">
                                            <div class="form-group" style="margin-bottom: 1rem;">
                                                <label class="form-label">Nome Completo</label>
                                                <input type="text" id="regUserName" class="form-input" required
                                                    placeholder="Ex: Jo√£o Silva">
                                            </div>
                                            <div class="form-group" style="margin-bottom: 1rem;">
                                                <label class="form-label">Login</label>
                                                <input type="text" id="regUserLogin" class="form-input" required
                                                    placeholder="usuario.sistema">
                                            </div>
                                            <div class="form-group" style="margin-bottom: 1rem;">
                                                <label class="form-label">Senha</label>
                                                <input type="text" id="regUserPass" class="form-input" required
                                                    placeholder="******">
                                            </div>
                                            <div class="form-group" style="margin-bottom: 1.5rem;">
                                                <label class="form-label">N√≠vel de Acesso</label>
                                                <select id="regUserRole" class="form-input">
                                                    <option value="user">Usu√°rio (Padr√£o)</option>
                                                    <option value="supervisor">Supervisor (Acesso Total)</option>
                                                    <option value="motoboy">Motoboy (App Moto)</option>
                                                    <option value="motorista">Motorista (App Carro)</option>
                                                </select>
                                                <small
                                                    style="color: var(--text-secondary); display: block; margin-top: 5px;">
                                                    Define quais abas o usu√°rio pode acessar.
                                                </small>
                                            </div>
                                            <div style="display: flex; gap: 10px;">
                                                <button type="submit" class="btn btn-primary" id="btnSaveUser"
                                                    style="width: 100%;">
                                                    <span class="material-icons-round">save</span> Salvar Usu√°rio
                                                </button>
                                                <button type="button" class="btn btn-secondary"
                                                    onclick="window.clearUserForm()">
                                                    Limpar
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>

                            <!-- COLUNA DIREITA: LISTA -->
                            <div>
                                <div class="card" style="height: 100%;">
                                    <div class="card-header">
                                        <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                            <span class="material-icons-round">group</span>
                                            Usu√°rios Cadastrados
                                        </h3>
                                    </div>
                                    <div class="card-body" style="padding: 1rem;" id="userListContainer">
                                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                                            Carregando lista...
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- VIEW: MONTAGEM CARGA -->
                <div id="view-dispatch" class="view-section" style="display: none;">

                    <div class="welcome-banner"
                        style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2>Montagem Carga</h2>
                            <p>Hist√≥rico completo de fretes despachados.</p>
                        </div>

                        <div style="display: flex; gap: 0.5rem; position: relative;">
                            <button id="btnExportCSV" class="btn btn-secondary"
                                style="padding: 0.5rem 1rem; gap: 0.5rem; background: rgba(39, 174, 96, 0.1); color: #2ecc71; border-color: rgba(39, 174, 96, 0.2);">
                                <span class="material-icons-round">download</span>
                                Exportar
                            </button>

                            <button class="btn btn-secondary"
                                onclick="document.getElementById('columnDropdown').classList.toggle('show')"
                                style="padding: 0.5rem 1rem; gap: 0.5rem;">
                                <span class="material-icons-round">settings</span>
                                Colunas
                            </button>

                            <div id="columnDropdown" class="dropdown-menu">
                                <div
                                    style="padding: 0.75rem; border-bottom: 1px solid var(--border-color); font-weight: 600; font-size: 0.8rem; color: var(--text-primary);">
                                    Selecionar Colunas
                                </div>
                                <div id="columnFilterBody" class="dropdown-content">
                                    <label class="check-label"><input type="checkbox" checked data-col="status">
                                        Status</label>


                                    <label class="check-label"><input type="checkbox" checked data-col="invoice">
                                        Nota
                                        Fiscal</label>
                                    <label class="check-label"><input type="checkbox" checked data-col="client">
                                        Cliente</label>
                                    <label class="check-label"><input type="checkbox" checked data-col="city">
                                        Cidade</label>
                                    <label class="check-label"><input type="checkbox" data-col="neighborhood">
                                        Bairro</label>
                                    <label class="check-label"><input type="checkbox" checked data-col="carrier">
                                        Transp.</label>
                                    <label class="check-label"><input type="checkbox" data-col="percentual"> %
                                        Frete</label>
                                    <label class="check-label"><input type="checkbox" data-col="minimo"> Frete
                                        M√≠n.</label>
                                    <label class="check-label"><input type="checkbox" data-col="redespacho">
                                        Redespacho</label>
                                    <label class="check-label"><input type="checkbox" data-col="horarios">
                                        Hor√°rio</label>
                                    <label class="check-label"><input type="checkbox" checked data-col="leadTime">
                                        Prazo</label>
                                    <label class="check-label"><input type="checkbox" data-col="nfValue"> Valor
                                        NF</label>
                                    <label class="check-label"><input type="checkbox" data-col="weight">
                                        Peso</label>
                                    <label class="check-label"><input type="checkbox" data-col="volume">
                                        Volume</label>

                                    <label class="check-label"><input type="checkbox" data-col="isComplement">
                                        Complemento</label>
                                    <label class="check-label"><input type="checkbox" data-col="mainInvoice"> NF
                                        Principal</label>
                                    <label class="check-label"><input type="checkbox" checked data-col="total">
                                        Frete
                                        Total</label>
                                    <label class="check-label"><input type="checkbox" checked data-col="createdTime"> Hr
                                        Cot.</label>
                                    <label class="check-label"><input type="checkbox" checked data-col="dispatchedTime">
                                        Hr
                                        Desp.</label>
                                    <label class="check-label"><input type="checkbox" checked data-col="actions">
                                        A√ß√µes</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="dispatchListContainer">
                        <!-- Will be populated by JS -->
                        <div style="text-align: center; color: var(--text-secondary);">
                            Nenhum despacho registrado.
                        </div>
                    </div>
                </div>

                <!-- VIEW: CONFER√äNCIA DE FATURA -->
                <div id="view-invoice" class="view-section" style="display: none;">
                    <div class="welcome-banner"
                        style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h2>üßæ Confer√™ncia de Fatura</h2>
                            <p>Compare faturas de transportadoras com as NFs despachadas e confirme o pagamento.</p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button id="btnInvoiceHistory" class="btn btn-secondary"
                                onclick="window.showInvoiceHistory()" style="padding: 0.5rem 1rem; gap: 0.5rem;">
                                <span class="material-icons-round">history</span>
                                Hist√≥rico
                            </button>
                        </div>
                    </div>

                    <!-- Filtro e Resumo -->
                    <div class="card" style="margin-bottom: 1.5rem;">
                        <div class="card-body" style="padding: 1.5rem;">
                            <div
                                style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1.5rem; align-items: end;">
                                <!-- Filtro Transportadora -->
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label class="form-label">Transportadora</label>
                                    <select id="invoiceCarrierFilter" class="form-input"
                                        onchange="window.filterInvoiceByCarrier(this.value)">
                                        <option value="">-- Selecione --</option>
                                    </select>
                                </div>

                                <!-- Valor da Fatura -->
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label class="form-label">Valor da Fatura (R$)</label>
                                    <input type="text" id="invoiceValue" class="form-input" placeholder="0,00"
                                        oninput="window.updateInvoiceComparison()">
                                </div>

                                <!-- Refer√™ncia da Fatura -->
                                <div class="form-group" style="margin-bottom: 0;">
                                    <label class="form-label">N¬∫ da Fatura (Ref.)</label>
                                    <input type="text" id="invoiceRef" class="form-input"
                                        placeholder="Ex: FAT-2026-001">
                                </div>

                                <!-- Bot√£o Selecionar Todos -->
                                <div style="display: flex; gap: 0.5rem;">
                                    <button class="btn btn-secondary" onclick="window.selectAllInvoiceNFs(true)"
                                        style="flex: 1; padding: 0.6rem;">
                                        <span class="material-icons-round" style="font-size: 1rem;">check_box</span>
                                        Todos
                                    </button>
                                    <button class="btn btn-secondary" onclick="window.selectAllInvoiceNFs(false)"
                                        style="flex: 1; padding: 0.6rem;">
                                        <span class="material-icons-round"
                                            style="font-size: 1rem;">check_box_outline_blank</span>
                                        Nenhum
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cards de Resumo -->
                    <div
                        style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                        <div class="card"
                            style="background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.3);">
                            <div class="card-body" style="padding: 1rem; text-align: center;">
                                <div
                                    style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                                    NFs Selecionadas</div>
                                <div id="invoiceSelectedCount"
                                    style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">0</div>
                            </div>
                        </div>
                        <div class="card"
                            style="background: rgba(16, 185, 129, 0.1); border-color: rgba(16, 185, 129, 0.3);">
                            <div class="card-body" style="padding: 1rem; text-align: center;">
                                <div
                                    style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                                    Total Calculado</div>
                                <div id="invoiceCalculatedTotal"
                                    style="font-size: 1.5rem; font-weight: 700; color: #10b981;">R$ 0,00</div>
                            </div>
                        </div>
                        <div class="card"
                            style="background: rgba(245, 158, 11, 0.1); border-color: rgba(245, 158, 11, 0.3);">
                            <div class="card-body" style="padding: 1rem; text-align: center;">
                                <div
                                    style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                                    Valor Fatura</div>
                                <div id="invoiceValueDisplay"
                                    style="font-size: 1.5rem; font-weight: 700; color: #f59e0b;">R$ 0,00</div>
                            </div>
                        </div>
                        <div id="invoiceDifferenceCard" class="card"
                            style="background: rgba(107, 114, 128, 0.1); border-color: rgba(107, 114, 128, 0.3);">
                            <div class="card-body" style="padding: 1rem; text-align: center;">
                                <div
                                    style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase;">
                                    Diferen√ßa</div>
                                <div id="invoiceDifference" style="font-size: 1.5rem; font-weight: 700;">R$ 0,00</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tabela de NFs -->
                    <div class="card">
                        <div class="card-header"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem; margin: 0;">
                                <span class="material-icons-round">list_alt</span>
                                NFs Despachadas Dispon√≠veis
                            </h3>
                            <span id="invoiceNFsCount" style="font-size: 0.8rem; color: var(--text-secondary);">0
                                notas</span>
                        </div>
                        <div class="card-body" style="padding: 0; max-height: 400px; overflow-y: auto;">
                            <table class="dispatch-table">
                                <thead>
                                    <tr>
                                        <th style="width: 40px; text-align: center;"><input type="checkbox"
                                                id="invoiceSelectAll"
                                                onchange="window.selectAllInvoiceNFs(this.checked)"></th>
                                        <th style="width: 70px;">NF</th>
                                        <th style="width: 200px;">Cliente</th>
                                        <th style="width: 100px;">Cidade</th>
                                        <th style="width: 90px;">Data Desp.</th>
                                        <th style="width: 100px; text-align: right;">Valor Frete</th>
                                    </tr>
                                </thead>
                                <tbody id="invoiceNFsBody">
                                    <tr>
                                        <td colspan="6"
                                            style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                                            Selecione uma transportadora para ver as NFs dispon√≠veis.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Bot√µes de A√ß√£o -->
                    <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem;">
                        <button id="btnClearInvoice" class="btn btn-secondary" onclick="window.clearInvoiceForm()"
                            style="padding: 0.75rem 1.5rem;">
                            <span class="material-icons-round" style="font-size: 1.1rem;">refresh</span>
                            Limpar
                        </button>
                        <button id="btnConfirmInvoice" class="btn btn-primary" onclick="window.confirmInvoicePayment()"
                            style="padding: 0.75rem 2rem;" disabled>
                            <span class="material-icons-round" style="font-size: 1.1rem;">check_circle</span>
                            Confirmar Pagamento
                        </button>
                    </div>
                </div>

                <!-- Modal Hist√≥rico de Faturas -->
                <div id="invoiceHistoryModal" class="login-overlay" style="display: none;">
                    <div class="login-card" style="max-width: 900px; width: 95%;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                            <h3 style="margin: 0;">üìã Hist√≥rico de Faturas Conferidas</h3>
                            <button onclick="document.getElementById('invoiceHistoryModal').style.display='none'"
                                class="btn btn-secondary" style="padding: 0.4rem; min-width: auto; border: none;">
                                <span class="material-icons-round">close</span>
                            </button>
                        </div>
                        <div style="max-height: 500px; overflow-y: auto;">
                            <table class="dispatch-table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Transportadora</th>
                                        <th>Ref. Fatura</th>
                                        <th>Qtd NFs</th>
                                        <th style="text-align: right;">Valor</th>
                                        <th>Conferido Por</th>
                                    </tr>
                                </thead>
                                <tbody id="invoiceHistoryBody">
                                    <tr>
                                        <td colspan="6"
                                            style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                                            Nenhuma fatura conferida ainda.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Modal Senha Supervisor -->
                <div id="invoiceSupervisorModal" class="login-overlay" style="display: none;">
                    <div class="login-card" style="max-width: 400px;">
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <span class="material-icons-round"
                                style="font-size: 3rem; color: var(--accent-warning);">warning</span>
                            <h3 style="margin: 0.5rem 0;">Diferen√ßa Detectada</h3>
                            <p style="color: var(--text-secondary); font-size: 0.9rem;">
                                O valor calculado n√£o confere com a fatura.<br>
                                Para continuar, informe a senha de um Supervisor.
                            </p>
                        </div>
                        <div id="invoiceDiffDetails"
                            style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem; text-align: center;">
                            <!-- Detalhes da diferen√ßa -->
                        </div>
                        <div class="form-group">
                            <label class="form-label">Senha do Supervisor</label>
                            <input type="password" id="invoiceSupervisorPass" class="form-input"
                                placeholder="Digite a senha">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Justificativa</label>
                            <input type="text" id="invoiceJustification" class="form-input"
                                placeholder="Motivo da diferen√ßa" required>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button class="btn btn-secondary"
                                onclick="document.getElementById('invoiceSupervisorModal').style.display='none'"
                                style="flex: 1;">Cancelar</button>
                            <button class="btn btn-primary" onclick="window.forceInvoicePayment()"
                                style="flex: 1;">Confirmar</button>
                        </div>
                    </div>
                </div>



                <!-- VIEW: INTEGRA√á√ÉO ACONTEC -->
                <div id="view-acontec" class="view-section" style="display: none;">

                    <div class="welcome-banner" style="margin-bottom: 2rem;">
                        <div>
                            <h2>üîå Integra√ß√£o Acontec</h2>
                            <p>Configure e gerencie a sincroniza√ß√£o autom√°tica de clientes com o sistema Acontec ERP.
                            </p>
                        </div>
                    </div>

                    <!-- CARD: CONFIGURA√á√ÉO API -->
                    <div class="card" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">api</span>
                                Configura√ß√£o da API
                            </h3>
                        </div>
                        <div class="card-body" style="padding: 1.5rem;">
                            <form id="formAcontecConfig" style="display: grid; gap: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">URL da API Acontec</label>
                                    <input type="url" id="acontecApiUrl" class="form-input"
                                        placeholder="https://api.acontec.com.br/v1" style="font-family: monospace;">
                                    <small style="color: var(--text-secondary); font-size: 0.75rem;">
                                        Informe a URL base fornecida pela Acontec (sem barra final)
                                    </small>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Token de Autentica√ß√£o (Bearer Token)</label>
                                    <input type="password" id="acontecApiToken" class="form-input"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="font-family: monospace;">
                                    <small style="color: var(--text-secondary); font-size: 0.75rem;">
                                        Token de acesso fornecido pela Acontec. Ser√° armazenado de forma segura.
                                    </small>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Sincroniza√ß√£o Autom√°tica</label>
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <label
                                            style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                                            <input type="checkbox" id="acontecAutoSync" style="width: auto;">
                                            <span>Ativar sincroniza√ß√£o autom√°tica</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="form-group" id="acontecSyncIntervalGroup" style="display: none;">
                                    <label class="form-label">Intervalo de Sincroniza√ß√£o (minutos)</label>
                                    <input type="number" id="acontecSyncInterval" class="form-input" min="5" max="1440"
                                        value="60" placeholder="60">
                                    <small style="color: var(--text-secondary); font-size: 0.75rem;">
                                        Intervalo entre sincroniza√ß√µes autom√°ticas (m√≠nimo: 5 min, m√°ximo: 24h)
                                    </small>
                                </div>

                                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                                    <button type="button" id="btnTestAcontecConnection" class="btn btn-secondary">
                                        <span class="material-icons-round" style="font-size: 1rem;">wifi_find</span>
                                        Testar Conex√£o
                                    </button>
                                    <button type="submit" class="btn btn-primary">
                                        <span class="material-icons-round" style="font-size: 1rem;">save</span>
                                        Salvar Configura√ß√µes
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- CARD: SINCRONIZA√á√ÉO MANUAL -->
                    <div class="card" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">sync</span>
                                Sincroniza√ß√£o de Clientes
                            </h3>
                        </div>
                        <div class="card-body" style="padding: 1.5rem;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                <div>
                                    <p style="margin: 0; color: var(--text-secondary);">
                                        Execute uma sincroniza√ß√£o manual para buscar os clientes mais recentes da
                                        Acontec.
                                    </p>
                                    <p id="acontecLastSyncInfo"
                                        style="margin: 0; margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">
                                        √öltima sincroniza√ß√£o: Nunca
                                    </p>
                                </div>
                                <button id="btnSyncAcontec" class="btn btn-primary" style="min-width: 200px;">
                                    <span class="material-icons-round" style="font-size: 1rem;">cloud_sync</span>
                                    Sincronizar Agora
                                </button>
                            </div>

                            <!-- Progress Bar -->
                            <div id="acontecSyncProgress"
                                style="display: none; background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                    <span class="material-icons-round"
                                        style="color: var(--primary-color); animation: spin 1s linear infinite;">sync</span>
                                    <span id="acontecProgressText">Sincronizando...</span>
                                </div>
                                <div
                                    style="background: var(--bg-body); height: 8px; border-radius: 4px; overflow: hidden;">
                                    <div id="acontecProgressBar"
                                        style="background: var(--primary-color); height: 100%; width: 0%; transition: width 0.3s;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CARD: ESTAT√çSTICAS -->
                    <div class="card" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">analytics</span>
                                Estat√≠sticas de Sincroniza√ß√£o
                            </h3>
                        </div>
                        <div class="card-body" style="padding: 1.5rem;">
                            <div
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                                <div
                                    style="text-align: center; padding: 1rem; background: rgba(34, 197, 94, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(34, 197, 94, 0.2);">
                                    <div
                                        style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">
                                        Total Sincronizado
                                    </div>
                                    <div id="acontecStatTotal"
                                        style="font-size: 2rem; font-weight: 700; color: var(--accent-success);">
                                        0
                                    </div>
                                </div>

                                <div
                                    style="text-align: center; padding: 1rem; background: rgba(59, 130, 246, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.2);">
                                    <div
                                        style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">
                                        Novos Clientes
                                    </div>
                                    <div id="acontecStatAdded"
                                        style="font-size: 2rem; font-weight: 700; color: var(--primary-color);">
                                        0
                                    </div>
                                </div>

                                <div
                                    style="text-align: center; padding: 1rem; background: rgba(251, 146, 60, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(251, 146, 60, 0.2);">
                                    <div
                                        style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">
                                        Atualizados
                                    </div>
                                    <div id="acontecStatUpdated"
                                        style="font-size: 2rem; font-weight: 700; color: var(--accent-warning);">
                                        0
                                    </div>
                                </div>

                                <div
                                    style="text-align: center; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(239, 68, 68, 0.2);">
                                    <div
                                        style="font-size: 0.75rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 0.5rem;">
                                        Erros
                                    </div>
                                    <div id="acontecStatErrors"
                                        style="font-size: 2rem; font-weight: 700; color: var(--accent-danger);">
                                        0
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 1rem; text-align: center;">
                                <button id="btnResetAcontecStats" class="btn btn-secondary"
                                    style="padding: 0.5rem 1.5rem;">
                                    <span class="material-icons-round" style="font-size: 1rem;">refresh</span>
                                    Resetar Estat√≠sticas
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- CARD: LOGS -->
                    <div class="card">
                        <div class="card-header"
                            style="display: flex; justify-content: space-between; align-items: center;">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">history</span>
                                Logs de Sincroniza√ß√£o
                            </h3>
                            <button id="btnClearAcontecLogs" class="btn btn-secondary"
                                style="padding: 0.5rem 1rem; font-size: 0.85rem;">
                                <span class="material-icons-round" style="font-size: 1rem;">delete_sweep</span>
                                Limpar Logs
                            </button>
                        </div>
                        <div class="card-body" style="padding: 0;">
                            <div id="acontecLogsList" style="max-height: 400px; overflow-y: auto;">
                                <div style="padding: 2rem; text-align: center; color: var(--text-secondary);">
                                    <span class="material-icons-round"
                                        style="font-size: 3rem; opacity: 0.3;">history</span>
                                    <p>Nenhum log dispon√≠vel</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- VIEW: SISTEMA (CONFIGS & BACKUP) -->
                <div id="view-system" class="view-section" style="display: none;">

                    <div class="welcome-banner"
                        style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h2>Configura√ß√µes do Sistema</h2>
                            <p>Gerenciamento de base de dados e informa√ß√µes da empresa.</p>
                        </div>
                    </div>

                    <div id="cardCompanyData" class="card admin-only" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">business</span>
                                Dados da Empresa Despachante (Cabe√ßalho do Romaneio)
                            </h3>
                        </div>
                        <div class="card-body" style="padding: 1.5rem;">
                            <form id="formCompanyData"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                                <div class="form-group">
                                    <label class="form-label">Nome Fantasia / Raz√£o Social</label>
                                    <input type="text" id="compName" class="form-input" placeholder="Minha Loja Ltda">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">CNPJ</label>
                                    <input type="text" id="compCNPJ" class="form-input"
                                        placeholder="00.000.000/0000-00">
                                </div>
                                <div class="form-group" style="grid-column: span 2;">
                                    <label class="form-label">Endere√ßo Completo</label>
                                    <input type="text" id="compAddress" class="form-input"
                                        placeholder="Av. Principal, 123 - Centro">
                                </div>
                                <div
                                    style="display: flex; align-items: flex-end; justify-content: flex-end; grid-column: 1 / -1; gap: 1rem;">
                                    <button type="button" id="btnEditCompany" class="btn btn-secondary"
                                        onclick="window.toggleCompanyEdit(true)"
                                        style="display: none; padding: 0.75rem 2rem;">
                                        <span class="material-icons-round"
                                            style="font-size: 1.1rem; margin-right: 0.5rem;">edit</span>
                                        ALTERAR DADOS
                                    </button>
                                    <button type="submit" id="btnSaveCompany" class="btn btn-primary"
                                        style="padding: 0.75rem 2rem;">
                                        <span class="material-icons-round"
                                            style="font-size: 1.1rem; margin-right: 0.5rem;">save</span>
                                        SALVAR DADOS
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Gest√£o de Funcion√°rios - LARGURA TOTAL -->
                    <div id="cardUserManagement" class="card admin-only" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">groups</span>
                                Gest√£o de Funcion√°rios e Permiss√µes
                            </h3>
                        </div>
                        <div class="card-body" style="padding: 1.5rem;">
                            <!-- Grid 2 colunas: Cadastro √† esquerda | Lista √† direita -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">

                                <!-- COLUNA ESQUERDA: Formul√°rio de Cadastro -->
                                <div style="border-right: 1px solid var(--border-color); padding-right: 2rem;">
                                    <h4 style="margin: 0 0 1rem 0; font-size: 0.95rem; color: var(--text-primary);">
                                        <span class="material-icons-round"
                                            style="font-size: 1.1rem; color: var(--primary-color); vertical-align: middle;">person_add</span>
                                        Novo Funcion√°rio
                                    </h4>

                                    <form id="formNewUser" style="display: flex; flex-direction: column; gap: 1rem;"
                                        onsubmit="window.handleUserFormSubmit(event)">
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">Nome Completo</label>
                                            <input type="text" id="newUserName" class="form-input"
                                                placeholder="Jo√£o Silva" required>
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">Usu√°rio (Login)</label>
                                            <input type="text" id="newUserLogin" class="form-input"
                                                placeholder="joao.silva" required>
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">Senha</label>
                                            <input type="password" id="newUserPass" class="form-input"
                                                placeholder="****" required>
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">N√≠vel</label>
                                            <select id="newUserRole" class="form-input" required>
                                                <option value="user">Operacional</option>
                                                <option value="supervisor">Supervisor</option>
                                                <option value="motoboy">üèçÔ∏è Motoboy</option>
                                                <option value="motorista">üöó Motorista</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary"
                                            style="padding: 0.75rem; margin-top: 0.5rem;">
                                            <span class="material-icons-round"
                                                style="font-size: 1.2rem;">person_add</span>
                                            CADASTRAR
                                        </button>
                                    </form>

                                    <!-- Dica compacta -->
                                    <div
                                        style="margin-top: 1.5rem; padding: 0.75rem; background: rgba(59, 130, 246, 0.08); border-radius: 8px; font-size: 0.8rem; color: var(--text-secondary);">
                                        <strong style="color: var(--primary-color);">‚ÑπÔ∏è N√≠veis:</strong><br>
                                        <strong>Operacional:</strong> Cota√ß√£o/carga<br>
                                        <strong>Supervisor:</strong> Acesso total<br>
                                        <strong>üèçÔ∏è Motoboy:</strong> Moto Entrega<br>
                                        <strong>üöó Motorista:</strong> Carro Entrega
                                    </div>
                                </div>

                                <!-- COLUNA DIREITA: Lista de Usu√°rios -->
                                <div>
                                    <h4 style="margin: 0 0 1rem 0; font-size: 0.95rem; color: var(--text-primary);">
                                        <span class="material-icons-round"
                                            style="font-size: 1.1rem; color: var(--accent-success); vertical-align: middle;">people</span>
                                        Usu√°rios Cadastrados
                                    </h4>

                                    <div style="overflow-y: auto; max-height: 350px;">
                                        <table class="dispatch-table" style="font-size: 0.85rem; width: 100%;">
                                            <thead>
                                                <tr>
                                                    <th style="text-align: left; padding: 0.6rem;">Nome</th>
                                                    <th style="text-align: left; padding: 0.6rem;">N√≠vel</th>
                                                    <th style="text-align: center; padding: 0.6rem; width: 60px;">A√ß√£o
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="userListBody">
                                                <!-- Populated by JS -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cadastro de Clientes - NOVA SE√á√ÉO -->
                    <div id="cardClientRegistration" class="card" style="margin-bottom: 2rem;">
                        <div class="card-header">
                            <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                <span class="material-icons-round">store</span>
                                Cadastro de Clientes
                            </h3>
                        </div>
                        <div class="card-body" style="padding: 1.5rem;">
                            <!-- Grid 2 colunas: Cadastro √† esquerda | Lista √† direita -->
                            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">

                                <!-- COLUNA ESQUERDA: Formul√°rio de Cadastro -->
                                <div style="border-right: 1px solid var(--border-color); padding-right: 2rem;">
                                    <h4 style="margin: 0 0 1rem 0; font-size: 0.95rem; color: var(--text-primary);">
                                        <span class="material-icons-round"
                                            style="font-size: 1.1rem; color: var(--primary-color); vertical-align: middle;">add_business</span>
                                        Novo Cliente
                                    </h4>

                                    <form id="formNewClient" style="display: flex; flex-direction: column; gap: 1rem;">
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">CNPJ/CPF</label>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <input type="text" id="newClientCNPJ" class="form-input"
                                                    placeholder="00.000.000/0000-00" style="flex: 1;">
                                                <button type="button" id="btnSearchClientCNPJ" class="btn btn-secondary"
                                                    style="padding: 0.5rem 1rem; white-space: nowrap;"
                                                    title="Buscar dados pelo CNPJ">
                                                    üîç
                                                </button>
                                            </div>
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">Nome/Raz√£o Social</label>
                                            <input type="text" id="newClientName" class="form-input"
                                                placeholder="Nome da Empresa" required>
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">C√≥digo</label>
                                            <input type="text" id="newClientCode" class="form-input"
                                                placeholder="C√≥digo interno (opcional)">
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">Cidade/UF</label>
                                            <input type="text" id="newClientCity" class="form-input"
                                                placeholder="Cidade - UF">
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">Bairro</label>
                                            <input type="text" id="newClientNeighborhood" class="form-input"
                                                placeholder="Bairro">
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">Endere√ßo</label>
                                            <input type="text" id="newClientAddress" class="form-input"
                                                placeholder="Rua, N√∫mero">
                                        </div>
                                        <div class="form-group" style="margin-bottom: 0;">
                                            <label class="form-label">Telefone</label>
                                            <input type="text" id="newClientPhone" class="form-input"
                                                placeholder="(00) 00000-0000">
                                        </div>
                                        <input type="hidden" id="editingClientMode" value="false">
                                        <input type="hidden" id="editingClientId" value="">
                                        <div style="display: flex; gap: 0.5rem;">
                                            <button type="button" id="btnCancelEditClient" class="btn btn-secondary"
                                                style="padding: 0.75rem; display: none; flex: 1;">
                                                CANCELAR
                                            </button>
                                            <button type="submit" id="btnSubmitClient" class="btn btn-primary"
                                                style="padding: 0.75rem; flex: 1;">
                                                <span class="material-icons-round"
                                                    style="font-size: 1.2rem;">add_business</span>
                                                CADASTRAR
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <!-- COLUNA DIREITA: Lista de Clientes -->
                                <div>
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                        <h4 style="margin: 0; font-size: 0.95rem; color: var(--text-primary);">
                                            <span class="material-icons-round"
                                                style="font-size: 1.1rem; color: var(--accent-success); vertical-align: middle;">people</span>
                                            Clientes Cadastrados
                                            <span id="clientCount"
                                                style="font-size: 0.85rem; color: var(--text-secondary);">(0)</span>
                                        </h4>
                                        <div style="display: flex; gap: 1rem; align-items: center;">
                                            <label class="check-label" style="color: var(--accent-danger);">
                                                <input type="checkbox" id="filterNoCoverage"
                                                    onchange="window.renderClientsList()">
                                                ‚ö†Ô∏è Sem Cobertura
                                            </label>
                                            <input type="text" id="searchClientInput" class="form-input"
                                                placeholder="üîç Buscar cliente..."
                                                style="max-width: 250px; padding: 0.5rem;">
                                        </div>
                                    </div>

                                    <div style="overflow-y: auto; max-height: 400px;">
                                        <table class="dispatch-table" style="font-size: 0.85rem; width: 100%;">
                                            <thead style="position: sticky; top: 0; background: var(--bg-secondary);">
                                                <tr>
                                                    <th style="text-align: left; padding: 0.6rem;">C√≥digo</th>
                                                    <th style="text-align: left; padding: 0.6rem;">Nome</th>
                                                    <th style="text-align: left; padding: 0.6rem;">Cidade</th>
                                                    <th style="text-align: center; padding: 0.6rem; width: 80px;">A√ß√µes
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody id="clientListBody">
                                                <!-- Populated by JS -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <!-- Card Backup -->
                        <div class="card">
                            <div class="card-header">
                                <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <span class="material-icons-round">cloud_download</span>
                                    Backup de Seguran√ßa
                                </h3>
                            </div>
                            <div class="card-body" style="padding: 1.5rem;">
                                <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;">
                                    Baixe todos os seus dados (Despachos e Tabelas Manuais) em um √∫nico arquivo de
                                    seguran√ßa.
                                    Recomendamos fazer isso semanalmente.
                                </p>
                                <button id="btnDownloadBackup" class="btn btn-primary"
                                    style="width: 100%; justify-content: center; gap: 0.5rem;">
                                    <span class="material-icons-round">download</span>
                                    BAIXAR BACKUP AGORA
                                </button>
                            </div>
                        </div>

                        <!-- Card Restaurar -->
                        <div class="card">
                            <div class="card-header">
                                <h3 style="font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                                    <span class="material-icons-round">cloud_upload</span>
                                    Restaurar Dados
                                </h3>
                            </div>
                            <div class="card-body" style="padding: 1.5rem;">
                                <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;">
                                    Se voc√™ trocou de computador ou limpou o navegador, pode subir seu arquivo de
                                    backup
                                    aqui para recuperar tudo.
                                </p>
                                <button id="btnTriggerRestore" class="btn btn-secondary"
                                    style="width: 100%; justify-content: center; gap: 0.5rem; border: 1px dashed var(--border-color);">
                                    <span class="material-icons-round">upload_file</span>
                                    SELECIONAR ARQUIVO (.JSON)
                                </button>
                                <input type="file" id="fileRestore" hidden accept=".json">
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- End of content-wrapper -->


            <!-- Footer / LGPD Notice -->
            <footer
                style="padding: 1rem 2rem; border-top: 1px solid var(--border-color); font-size: 0.75rem; color: var(--text-secondary); display: flex; justify-content: space-between; align-items: center; background: var(--bg-card);">
                <div>
                    <strong>&copy; 2024 ParreiraLog</strong> - Gest√£o Log√≠stica Inteligente
                </div>
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span class="material-icons-round"
                        style="font-size: 1rem; color: var(--accent-success);">security</span>
                    <span>Ambiente Seguro: Dados processados localmente em conformidade com a LGPD.</span>
                </div>
                <div id="systemVersion" style="font-size: 0.8rem; color: #666; margin-left: auto;">
                    Carregando vers√£o...
                </div>
            </footer>
        </main>
    </div>

    <div id="print-area" style="display: none;"></div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script src="firebase-config.js"></script>
    <script src="utils.js"></script>
    <script src="data.js"></script>
    <script src="acontec-integration.js"></script>
    <script src="app.js"></script>
    <script src="acontec-ui.js"></script>
    <script src="delivery-module.js"></script>
    <script src="cnpj-lookup.js"></script>

    <!-- Service Worker Registration -->
    <script>
        // SERVICE WORKER TEMPORARILY DISABLED FOR DEBUGGING
        /*
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((reg) => console.log('‚úÖ SW registered:', reg.scope))
                    .catch((err) => console.log('‚ùå SW failed:', err));
            });
        }
        */
        // Unregister existing SW if any
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister();
                    console.log('üßπ SW Unregistered to force update');
                }
            });
        }
    </script>
</body>


</html>